---
contentKey: chapter
title: Attendees Screen
stepNo: 5
metaTitle: Attendees Screen page
metaDescription: Attendees Screen description
date: 2022-01-25T21:11:31.867Z
duration: 30 min
tags:
  - flutter
  - firebase
keywords:
  - flutter
  - firebase
---
# 🧑‍🤝‍🧑 Attendees Screen

After login we need to redirect to `attendees_screen`, 

Create a new 📄 file under `screens` 📁 folder  => **attendees_screen.dart**

```
import 'package:flutter/material.dart';

import 'package:gdg_flutter_firebase_chat/models/user.dart';

import 'package:gdg_flutter_firebase_chat/models/user_data.dart';

import 'package:gdg_flutter_firebase_chat/services/auth_service.dart';

import 'package:gdg_flutter_firebase_chat/services/database_service.dart';

import 'package:gdg_flutter_firebase_chat/widgets/all_attendees_widget.dart';

import 'package:provider/provider.dart';

 

class AttendeesScreen extends StatefulWidget {

  static final String id ='attendees_screen';

 

 @override

 _AttendeesScreenState createState() => _AttendeesScreenState();

}

 

class _AttendeesScreenState extends State<AttendeesScreen> {

 List<User> _users = \[];

 @override

 void initState() {

   super.initState();

   _setupAttendees();

 }

 

 _setupAttendees() async {

   String currentUserId =Provider.of<UserData>(context, listen: false).currentUserId;

   List<User> users = await Provider.of<DataBaseService>(context, listen: false)

                     .getAllUsers(currentUserId);

   if (mounted) {

     setState(() {

       _users = users;

     });

   }

 }

 @override

 Widget build(BuildContext context) {

   

   return Scaffold(

     backgroundColor: Theme.of(context).primaryColor,

     appBar: AppBar(

       leading: IconButton(

         icon: Icon(Icons.menu),

         iconSize: 30.0,

         color: Colors.white,

         onPressed: () {},

       ),

       title: Text(

         'Attendees',

         style: TextStyle(

           fontSize: 28.0,

           fontWeight: FontWeight.bold,

         ),

       ),

       elevation: 0.0,

       actions: <Widget>[

         IconButton(

           icon: Icon(Icons.exit_to_app),

           onPressed: Provider.of<AuthService>(context, listen: false).logout,

         ),

       ],

     ),

     body: Column(

       children: <Widget>[

         Expanded(

           child: Container(

             decoration: BoxDecoration(

               color: Theme.of(context).accentColor,

               borderRadius: BorderRadius.only(

                 topLeft: Radius.circular(30.0),

                 topRight: Radius.circular(30.0),

               ),

             ),

             child: Column(

               children: <Widget>[

                  AllAttendees(users:_users),

               ],

             ),

           ),

         ),

       ],

     ),

   );

 }

}
```

### Model to Store Current User data

To store current user data we will create a model -> user_data.dart under models 📁 folder it extends ChangeNotifierProvider

```
import 'package:flutter/cupertino.dart';

 

class UserData extends ChangeNotifier {

  String currentUserId;

}
```

We use to pass data between screens, for that we will use provider package A mixture between dependency injection (DI) and state management, built with widgets for widgets.

> `provider: ^4.0.3`

The attendees are all the users they have registered. We update our database service and create a new function to get all users.

services

📄 File => database_service.dart

```
import 'package:cloud_firestore/cloud_firestore.dart';

import 'package:gdg_flutter_firebase_chat/helpers/constants.dart';

import 'package:gdg_flutter_firebase_chat/models/user.dart';

 

class DataBaseService {

 Future<User> getUser(String userId) async {

   DocumentSnapshot userDoc = await usersRef.document(userId).get();

   return User.fromDoc(userDoc);

 }

 

 Future<List<User>> getAllUsers(String currentUserId) async {

   QuerySnapshot userSnapshot = await usersRef.getDocuments();

   List<User> users = \[];

   userSnapshot.documents.forEach((doc) {

     User user = User.fromDoc(doc);

     if (user.id != currentUserId) users.add(user);

   });

   return users;

 }

}
```

### Introduction to widget - separation of concern

Create a 📁 folder for ‘widgets’ => add 📄 file all_attendees_widget.dart

```
import 'package:flutter/material.dart';

import 'package:gdg_flutter_firebase_chat/models/user.dart';

import 'package:gdg_flutter_firebase_chat/screens/chat_screen.dart';

import 'package:cached_network_image/cached_network_image.dart';

 

class AllAttendees extends StatelessWidget {

 final List<User> users;

 

 const AllAttendees({this.users});

 @override

 Widget build(BuildContext context) {

   return Expanded(

     child: Container(

       decoration: BoxDecoration(

         color: Colors.white,

       

       ),

       child: Padding(

         padding: const EdgeInsets.all(8.0),

         child: ListView.builder(

           itemCount: users.length,

           itemBuilder: (BuildContext context, int index) {

             final User user = users\[index];

             return GestureDetector(

               onTap: () => Navigator.push(

                 context,

                 MaterialPageRoute(

                   builder: (_) => ChatScreen(

                       // user: chat.sender,

                       ),

                 ),

               ),

               child: Container(

                 margin: EdgeInsets.only(top: 5.0, bottom: 5.0, right: 5.0),

                 padding:

                     EdgeInsets.symmetric(horizontal: 10.0, vertical: 10.0),

                 decoration: BoxDecoration(

                   color: Color(0xFFFFEFEE),

                   borderRadius: BorderRadius.all( Radius.circular(20.0)

                   ),

                 ),

                 child: Row(

                   mainAxisAlignment: MainAxisAlignment.spaceBetween,

                   children: <Widget>[

                     Row(

                       children: <Widget>[

                         CircleAvatar(

                           radius: 35.0,

                           backgroundImage: user.profileImageUrl.isEmpty

                               ? AssetImage('assets/images/user_placeholder.jpg')

                               : CachedNetworkImageProvider(user.profileImageUrl),

                         ),

                         SizedBox(width: 10.0),

                         Column(

                           crossAxisAlignment: CrossAxisAlignment.start,

                           children: <Widget>[

                             Text(

                               user.name,

                               style: TextStyle(

                                 color: Colors.grey,

                                 fontSize: 15.0,

                                 fontWeight: FontWeight.bold,

                               ),

                             ),

                             SizedBox(height: 5.0),

                             Text(

                               user.bio,

                               style: TextStyle(

                                 color: Colors.grey,

                                 fontSize: 15.0,

                               ),

                             ),

                           ],

                         ),

                       ],

                     ),

                   ],

                 ),

               ),

             );

           },

         ),

       ),

     ),

   );

 }

}
```

### User profile images

Profile images will come from the network, We will use Flutter library to load and cache network images We are using cached_network_image ,add to pubspec.yaml and get the package..

>  `cached_network_image: ^2.0.0`

We got all our references now we need to navigate from main to attendees screen if we are logged in.

Quickly update login screen and give it an id , will be used for routes

```
class LoginScreen extends StatefulWidget {

   static final String id ='login_screen';
```

### Main.dart Refactoring

We will refactor main.dart, and check if the is logged in , wei will create a new class that extends statelessWwidget.

```
class MyApp extends StatelessWidget {

 Widget _getScreenId() {

   return StreamBuilder<FirebaseUser>(

     stream: FirebaseAuth.instance.onAuthStateChanged,

     builder: (BuildContext context, snapshot) {

       if (snapshot.hasData) {

         Provider.of<UserData>(context).currentUserId = snapshot.data.uid;

         return AttendeesScreen();

       } else {

         return LoginScreen();

       }

     },

   );

 }
  // This widget is the root of your application.

 @override

 Widget build(BuildContext context) {

   return MaterialApp(

     title: "GDG Firebase chat",

     debugShowCheckedModeBanner: false,

     theme: ThemeData(

       primaryColor: AppConstants.hexToColor(AppConstants.APP_PRIMARY_COLOR),

       backgroundColor:

           AppConstants.hexToColor(AppConstants.APP_BACKGROUND_COLOR),

       primaryColorLight:

           AppConstants.hexToColor(AppConstants.APP_PRIMARY_COLOR_LIGHT),

       accentColor: Colors.black,

       accentIconTheme: IconThemeData(color: Colors.black),

       dividerColor: Colors.black12,

       textTheme: TextTheme(

         caption: TextStyle(color: Colors.white),

       ),

     ),

     home: _getScreenId(),

     routes: {

       LoginScreen.id: (context) => LoginScreen(),

       AttendeesScreen.id: (context) => AttendeesScreen(),

     },

   );

 }

}
```

 And modify run app to call MyApp(), I will also define all my providers for app

```
runApp(MultiProvider(providers: [
   ChangeNotifierProvider(
     create: (_) => UserData(),
   ),

   Provider<AuthService>(
     create: (_) => AuthService(),
   ),

   Provider<DataBaseService>(
     create: (_) => DataBaseService(),
   ),

 ], child: MyApp()));

}
```

We can see the attendees screen with a list of attendees.
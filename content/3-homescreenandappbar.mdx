---
contentKey: chapter
title: HomeScreenandLogin
stepNo: 3
metaTitle: This is the title tag of this page
metaDescription: This is the meta description
date: 2021-01-13T22:58:35.993Z
duration: 30 min
tags:
  - flutter
  - firebase
keywords:
  - flutter
  - firebase
  - studying
---
# ðŸ  Home Screen and Login

## Authentication and Login

Lets first add login screen for that we need to call auth service, We create aÂ Folder = > services

File -> auth_service.dart 

![](https://lh6.googleusercontent.com/Lk7Jw0Uz-qisdjEl2B--b8QzB2vbqCb_OylwIh3qghHB4t5ulXZ0dPoszLh310Rpce4xyhRj_Fdj7XenBV_K1QUxceODhRahqTjsS2jQTXnTTmE7CFC4JPhOph0yh_-Ya55hl13r)

```dart
Future<void> signup(String name, String email, String password) async {

Future<void> login(String email, String password) async {

Future<void> logout() {

}

Â 

class AuthService {

Â Â final FirebaseAuth _firebaseAuth = FirebaseAuth.instance;

Â Â Â Stream<FirebaseUser> get user => _firebaseAuth.onAuthStateChanged;

Â 

Â Â Future<void> signup(String name, String email, String password) async {

Â Â Â Â try {

Â Â Â Â Â Â AuthResult authResult = await _firebaseAuth.createUserWithEmailAndPassword(

Â Â Â Â Â Â Â Â Â Â email: email, password: password);

Â 

Â Â Â Â } on PlatformException catch (error) {

Â Â Â Â Â Â throw (error);

Â Â Â Â }

Â Â }

Â 

Â Â Future<void> login(String email, String password) async {

Â Â Â Â try {

Â Â Â Â Â Â await _firebaseAuth.signInWithEmailAndPassword(

Â Â Â Â Â Â Â Â Â Â email: email, password: password);

Â Â Â Â } on PlatformException catch (error) {

Â Â Â Â Â Â throw (error);

Â Â Â Â }

Â Â }

Â 

Â Â Future<void> logout() {

Â Â Â Â Future.wait(\[_firebaseAuth.signOut()]);

Â Â }

}
```

I would also like this user to be stored in a database, so that we can use it in chat.

I will create a constants.dart file under helpers folder

```dart
import 'package:cloud_firestore/cloud_firestore.dart';

import 'package:firebase_storage/firebase_storage.dart';Â 

final Firestore _db = Firestore.instance;

final usersRef = _db.collection('users');

final chatsRef = _db.collection('chats');

Â 

final FirebaseStorage _storage = FirebaseStorage.instance;

final storageRef =_storage.ref();
```

And update auth_service.dart

```dart
Â Â if (authResult.user != null) {

Â Â Â Â Â Â Â Â String token = await _firebaseMessaging.getToken();

Â Â Â Â Â Â Â Â usersRef.document(authResult.user.uid).setData({

Â Â Â Â Â Â Â Â Â Â 'name': name,

Â Â Â Â Â Â Â Â Â Â 'email': email,Â 

Â Â Â Â Â Â Â Â Â Â 'profileImageUrl': '',

Â Â Â Â Â Â Â Â Â Â 'bio': '',

Â Â Â Â Â Â Â Â Â Â 'token': token,

Â Â Â Â Â Â Â Â });

Â Â Â Â Â Â }
```

Full code.=> <https://github.com/sumithpdd/gdg_flutter_firebase_chat/blob/Authentication/lib/services/auth_service.dart>

Modify user_models.dart to match these fields and map data from the database.

```dartÂ 
class User {

Â Â final String id;

Â Â final String name;

Â Â final String profileImageUrl, email, bio, token;

Â Â // {} named parameters

Â Â User(

Â Â Â Â Â Â {this.id,

Â Â Â Â Â Â this.name,

Â Â Â Â Â Â this.profileImageUrl,

Â Â Â Â Â Â this.email,

Â Â Â Â Â Â this.bio,

Â Â Â Â Â Â this.token});

Â 

Â Â factory User.fromDoc(DocumentSnapshot doc) {

Â Â Â Â return User(

Â Â Â Â Â Â Â Â id: doc.documentID,

Â Â Â Â Â Â Â Â name: doc\['name'],

Â Â Â Â Â Â Â Â profileImageUrl: doc\['profileImageUrl'],

Â Â Â Â Â Â Â Â email: doc\['email'],

Â Â Â Â Â Â Â Â bio: doc\['bio'],

Â Â Â Â Â Â Â Â token: doc\['token']);

Â Â }

}
```

Highlight this piece of code

```dart
Â Â // {} named parameters

Â Â User({this.id, this.name, this.email, this.token});



factory User.fromDoc(DocumentSnapshot doc)
```

## Check firebase Console

Make sure database and authentication is set

![](https://lh6.googleusercontent.com/e_-JL_16fpMEksS5Tx8tHD9JXlJtsqdcdj7KW4KCNGMb8Y1AxSk6iY6YoEwssHWR22CmMJx89xfrZ3zGAIfIsCIheQ4P8yMbigqTyMo89WcCPiQlnIFc8X9WwLg6orm8mC4SqW3b)

![](https://lh5.googleusercontent.com/CGzpIm7sfFAeuRmgjsRwEpTEJI-1usNaI9cnrerFqzQK6ntT_La83AUpL_mIHHY6AxT79rsE6m7NH4ClabpbSt-xqHmWILB0cwmPD3Ra_AP47LaZtwTx-nUPvHGI2bdCXPVGnToP)

#### Messages will break as user model has changed so we will fix message.dart

```
// YOU - current user

final User currentUser = User(

Â id: '0',

Â name: 'Current User',

Â profileImageUrl: 'assets/images/greg.jpg',

);

final User sumith = User(

Â id: '1',

Â name: 'sumith',

Â profileImageUrl: 'assets/images/greg.jpg',

);

final User martin = User(

Â id: '2',

Â name: 'martin',

Â profileImageUrl: 'assets/images/james.jpg',

);

final User laura = User(

Â id: '3',

Â name: 'laura',

Â profileImageUrl: 'assets/images/john.jpg',

);

final User bilal = User(

Â id: '4',

Â name: 'bilal',

Â profileImageUrl: 'assets/images/olivia.jpg',

);

final User sam = User(

Â id: '5',

Â name: 'Sam',

Â profileImageUrl: 'assets/images/sam.jpg',

);

final User sophia = User(

Â id: '6',

Â name: 'Sophia',

Â profileImageUrl: 'assets/images/sophia.jpg',

);

final User steven = User(

Â id: '7',

Â name: 'Steven',

Â profileImageUrl: 'assets/images/steven.jpg',

);
```



## Step 2 - Login and Signup Screen

To check if authentication is working , We create a new screen for Login and Signup

Folder => screens

File=> login_screen.dart

Code from login screen->

```
import 'package:flutter/material.dart';

import 'package:flutter/services.dart';

import 'package:gdg_flutter_firebase_chat/helpers/app_constants.dart';

import 'package:gdg_flutter_firebase_chat/services/auth_service.dart';

class LoginScreen extends StatefulWidget {

Â @override

Â _LoginScreenState createState() => _LoginScreenState();

}

class _LoginScreenState extends State<LoginScreen> {

Â final _loginFormKey = GlobalKey<FormState>();

Â final _signupFormKey = GlobalKey<FormState>();

Â String _name, _email, _password;

Â int _selectedIndex = 0;

Â _buildLoginForm() {

Â Â Â return Form(

Â Â Â Â Â key: _loginFormKey,

Â Â Â Â Â child: Column(children: <Widget>[

Â Â Â Â Â Â Â _buildEmailTF(),

Â Â Â Â Â Â Â _buildPasswordTF(),

Â Â Â Â Â ]),

Â Â Â );

Â }

Â _buildSignupForm() {

Â Â Â return Form(

Â Â Â Â Â key: _signupFormKey,

Â Â Â Â Â child: Column(children: <Widget>[

Â Â Â Â Â Â Â _buildNameTF(),

Â Â Â Â Â Â Â _buildEmailTF(),

Â Â Â Â Â Â Â _buildPasswordTF(),

Â Â Â Â Â ]),

Â Â Â );

Â }

Â _buildNameTF() {

Â Â Â return Padding(

Â Â Â Â Â padding: const EdgeInsets.symmetric(horizontal: 30.0, vertical: 10.0),

Â Â Â Â Â child: TextFormField(

Â Â Â Â Â Â Â decoration: const InputDecoration(labelText: 'Name'),

Â Â Â Â Â Â Â validator: (input) =>

Â Â Â Â Â Â Â Â Â Â Â input.trim().isEmpty ? 'Please enter a vaild name' : null,

Â Â Â Â Â Â Â onSaved: (input) => _name = input.trim(),

Â Â Â Â Â ),

Â Â Â );

Â }

Â _buildEmailTF() {

Â Â Â return Padding(

Â Â Â Â Â padding: const EdgeInsets.symmetric(horizontal: 30.0, vertical: 10.0),

Â Â Â Â Â child: TextFormField(

Â Â Â Â Â Â Â decoration: const InputDecoration(labelText: 'Email'),

Â Â Â Â Â Â Â validator: (input) =>

Â Â Â Â Â Â Â Â Â Â Â !input.contains('@') ? 'Please enter a vaild email' : null,

Â Â Â Â Â Â Â onSaved: (input) => _email = input,

Â Â Â Â Â ),

Â Â Â );

Â }

Â _buildPasswordTF() {

Â Â Â return Padding(

Â Â Â Â Â padding: const EdgeInsets.symmetric(horizontal: 30.0, vertical: 10.0),

Â Â Â Â Â child: TextFormField(

Â Â Â Â Â Â Â decoration: const InputDecoration(labelText: 'Password'),

Â Â Â Â Â Â Â validator: (input) =>

Â Â Â Â Â Â Â Â Â Â Â input.length < 6 ? 'Password must be atleast 6 characters' : null,

Â Â Â Â Â Â Â onSaved: (input) => _password = input,

Â Â Â Â Â Â Â obscureText: true,

Â Â Â Â Â ),

Â Â Â );

Â }

Â _submit() async {

Â Â Â try {

Â Â Â Â Â if (_selectedIndex == 0 && _loginFormKey.currentState.validate()) {

Â Â Â Â Â Â Â _loginFormKey.currentState.save();

Â Â Â Â Â Â Â await authservice.login(_email, _password);

Â Â Â Â Â } else if (_selectedIndex == 1 &&

Â Â Â Â Â Â Â Â Â _signupFormKey.currentState.validate()) {

Â Â Â Â Â Â Â _signupFormKey.currentState.save();

Â Â Â Â Â Â Â await authservice.signup(_name, _email, _password);

Â Â Â Â Â }

Â Â Â } on PlatformException catch (error) {

Â Â Â Â Â _showErrorDialog(error.message);

Â Â Â }

Â }

Â _showErrorDialog(String errorMessage) {

Â Â Â showDialog(

Â Â Â Â Â context: context,

Â Â Â Â Â builder: (_) {

Â Â Â Â Â Â Â return AlertDialog(

Â Â Â Â Â Â Â Â Â title: Text('Error'),

Â Â Â Â Â Â Â Â Â content: Text(errorMessage),

Â Â Â Â Â Â Â Â Â actions: <Widget>[

Â Â Â Â Â Â Â Â Â Â Â FlatButton(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â onPressed: () => Navigator.pop(context), child: Text('OK'))

Â Â Â Â Â Â Â Â Â ],

Â Â Â Â Â Â Â );

Â Â Â Â Â },

Â Â Â );

Â }

Â final AuthService authservice =Â  AuthService();

Â @override

Â Widget build(BuildContext context) {

Â Â Â return Scaffold(

Â Â Â Â Â body: Center(

Â Â Â Â Â Â Â child: Column(

Â Â Â Â Â Â Â Â Â mainAxisAlignment: MainAxisAlignment.center,

Â Â Â Â Â Â Â Â Â children: <Widget>[

Â Â Â Â Â Â Â Â Â Â Â Text('Welcome!',

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style: TextStyle(fontSize: 30.0, fontWeight: FontWeight.w600)),

Â Â Â Â Â Â Â Â Â Â Â const SizedBox(height: 10.0),

Â Â Â Â Â Â Â Â Â Â Â Row(

Â Â Â Â Â Â Â Â Â Â Â Â Â mainAxisAlignment: MainAxisAlignment.spaceEvenly,

Â Â Â Â Â Â Â Â Â Â Â Â Â children: <Widget>[

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Container(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â width: 150.0,

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â child: FlatButton(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â shape: RoundedRectangleBorder(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â borderRadius: BorderRadius.circular(10.0),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â color: _selectedIndex == 0 ? AppConstants.hexToColor(AppConstants.APP_PRIMARY_COLOR) : Colors.grey\[300],

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â child: Text(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'Login',

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style: TextStyle(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â fontSize: 20.0,

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â color:

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â _selectedIndex == 0 ? Colors.white : AppConstants.hexToColor(AppConstants.APP_PRIMARY_COLOR)),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â onPressed: () => setState(() => _selectedIndex = 0),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Container(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â width: 150.0,

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â child: FlatButton(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â shape: RoundedRectangleBorder(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â borderRadius: BorderRadius.circular(10.0),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â color: _selectedIndex == 1 ? AppConstants.hexToColor(AppConstants.APP_PRIMARY_COLOR) : Colors.grey\[300],

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â child: Text(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'Sign Up',

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style: TextStyle(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â fontSize: 20.0,

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â color:

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â _selectedIndex == 1 ? Colors.white : AppConstants.hexToColor(AppConstants.APP_PRIMARY_COLOR)),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â onPressed: () => setState(() => _selectedIndex = 1),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â )

Â Â Â Â Â Â Â Â Â Â Â Â Â ],

Â Â Â Â Â Â Â Â Â Â Â ),

Â Â Â Â Â Â Â Â Â Â Â _selectedIndex == 0 ? _buildLoginForm() : _buildSignupForm(),

Â Â Â Â Â Â Â Â Â Â Â const SizedBox(height: 20.0),

Â Â Â Â Â Â Â Â Â Â Â Container(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â width: 180,

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â child: FlatButton(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â shape: RoundedRectangleBorder(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â borderRadius: BorderRadius.circular(10.0)),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â color: AppConstants.hexToColor(AppConstants.APP_PRIMARY_COLOR),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â onPressed: _submit,

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â child: Text(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 'Submit',

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â style: TextStyle(

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â color: Colors.white,

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â fontSize: 20.0,

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ),

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ))

Â Â Â Â Â Â Â Â Â ],

Â Â Â Â Â Â Â ),

Â Â Â Â Â ),

Â Â Â );

Â }

}
```

### Update Main.dart

```
),

Â Â Â Â Â Â home: LoginScreen(),

Â Â Â Â ),
```

Â Â Â 

Â 

### Working Login and Signup Screen

![](https://lh3.googleusercontent.com/BmurLiEy27wYYjOs-Tg_VSHb6LxVOoHPbXz6H8tZe_ZCQExVqj6uWjBZh1yHHGyTzfQXyzd-l0hDoLXO7b1t9UzK1-MOU0ipj1omMU0XsQ-PUhD7180kwB-Fo_J8e-pC_JkJYMWf)

![](https://lh3.googleusercontent.com/1lQyrNi1NN1tKtsGvC3Wb-q6eMQjYKzJiT_tErF6HSXwngiEfIFuiRjWMY3v9g5qWbAwjoPZ61kMq3l0I8oaxIE5IKOkZ8P1qhT-qJIx3Vcq4zFkKzIrr9m5ztueAUWWxe4zus-0)

![](https://lh5.googleusercontent.com/2hvc54FU0msG1TTRjmaXWIdFp3lgYT2kEZSaVX9Q6LdBL65wgP2Xmd5LJBodz-Wf1YFLMXSoipIEkGCoh_a7zlQmla2CS6ozJeB622ol7UoyDZEAVYVNywIqmsG3lFKmuMGl-Th9)